# PROJECT BIBLE ‚Äî Calink Support Bot

## –ß—Ç–æ —ç—Ç–æ?

Telegram-–±–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ [Calink](https://calink.ru). –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –º–æ—Å—Ç –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –∏ –∫–æ–º–∞–Ω–¥–æ–π —Å–∞–ø–ø–æ—Ä—Ç–∞.

**–ö–ª–∏–µ–Ω—Ç** –ø–∏—à–µ—Ç –±–æ—Ç—É –≤ –ª–∏—á–∫—É ‚Üí **–±–æ—Ç** —Å–æ–∑–¥–∞—ë—Ç —Ç–æ–ø–∏–∫ –≤ –≥—Ä—É–ø–ø–µ —Å–∞–ø–ø–æ—Ä—Ç–∞ –∏ –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç —Ç—É–¥–∞ ‚Üí **—Å–∞–ø–ø–æ—Ä—Ç** –æ—Ç–≤–µ—á–∞–µ—Ç reply –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç–∞ ‚Üí **–±–æ—Ç** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É.

---

## –°—Ç–µ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è |
|-----------|------------|
| –Ø–∑—ã–∫ | Python 3.11+ |
| Telegram API | `python-telegram-bot[all]` v21+ |
| –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö | SQLite (`aiosqlite`) |
| HTTP-–∫–ª–∏–µ–Ω—Ç | `httpx` (async, –¥–ª—è Calink API) |
| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | `python-dotenv` (.env —Ñ–∞–π–ª) |
| –•–æ—Å—Ç–∏–Ω–≥ | [Railway.app](https://railway.app) |
| Git | GitHub ‚Üí `calinkru-hue/calink-helpbot` |

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
‚îú‚îÄ‚îÄ bot.py           # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª: —Ö–µ–Ω–¥–ª–µ—Ä—ã, –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
‚îú‚îÄ‚îÄ database.py      # SQLite: —Ç–∞–±–ª–∏—Ü—ã users –∏ messages
‚îú‚îÄ‚îÄ calink_api.py    # –ö–ª–∏–µ–Ω—Ç –¥–ª—è Calink API (–ø–æ–∏—Å–∫ —é–∑–µ—Ä–∞ –ø–æ telegram_id)
‚îú‚îÄ‚îÄ config.py        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ .env + —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
‚îú‚îÄ‚îÄ requirements.txt # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ Procfile         # –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞ –¥–ª—è Railway
‚îú‚îÄ‚îÄ .env             # –°–µ–∫—Ä–µ—Ç—ã (–ù–ï –≤ git!)
‚îî‚îÄ‚îÄ .env.example     # –®–∞–±–ª–æ–Ω .env
```

---

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------------|----------|--------|
| `BOT_TOKEN` | –¢–æ–∫–µ–Ω –æ—Ç @BotFather | `123456:ABC-DEF...` |
| `SUPPORT_GROUP_ID` | ID –≥—Ä—É–ø–ø—ã —Å–∞–ø–ø–æ—Ä—Ç–∞ (—Å `-100`) | `-1001234567890` |
| `CALINK_API_SECRET` | –°–µ–∫—Ä–µ—Ç –¥–ª—è Calink API (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) | `HE110_k3y_f0r_SUPp0rt_h00k` |

---

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–æ—Ç

### –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç –ø–∏—à–µ—Ç –±–æ—Ç—É

1. `/start` ‚Üí –±–æ—Ç —à–ª—ë—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ (–ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –µ—Å–ª–∏ —é–∑–µ—Ä –µ—Å—Ç—å –≤ Calink)
2. –ü–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí –±–æ—Ç —Å–æ–∑–¥–∞—ë—Ç **—Ç–æ–ø–∏–∫** –≤ –≥—Ä—É–ø–ø–µ —Å–∞–ø–ø–æ—Ä—Ç–∞
3. –ë–æ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç **Calink API** –ø–æ telegram_id —é–∑–µ—Ä–∞
4. –í —Ç–æ–ø–∏–∫–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è **–∫–∞—Ä—Ç–æ—á–∫–∞** (UID, –∏–º—è, —Å—Å—ã–ª–∫–∞, —Ç–∞—Ä–∏—Ñ) –∏ **–ø–∏–Ω–∏—Ç—Å—è**
5. –°–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç—Å—è –≤ —Ç–æ–ø–∏–∫
6. –ß–µ—Ä–µ–∑ **5 —Å–µ–∫—É–Ω–¥** –±–æ—Ç —à–ª—ë—Ç –∞–≤—Ç–æ-–æ—Ç–≤–µ—Ç: ¬´ok, —Å–∫–æ—Ä–æ –æ—Ç–≤–µ—Ç–∏–º!¬ª (max 1 —Ä–∞–∑ –≤ –¥–µ–Ω—å)

### –°–∞–ø–ø–æ—Ä—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç—É

- **Reply –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç–∞** –≤ —Ç–æ–ø–∏–∫–µ ‚Üí –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—É + üëç —Ä–µ–∞–∫—Ü–∏—è
- **–ü—Ä–æ—Å—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ** –≤ —Ç–æ–ø–∏–∫–µ ‚Üí –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ, –∫–ª–∏–µ–Ω—Ç –ù–ï –≤–∏–¥–∏—Ç

### –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ

- **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: —Å–∞–ø–ø–æ—Ä—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —Å–≤–æ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —É –∫–ª–∏–µ–Ω—Ç–∞ + ‚úç —Ä–µ–∞–∫—Ü–∏—è
- **–£–¥–∞–ª–µ–Ω–∏–µ**: reply –Ω–∞ —Å–≤–æ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ + `/del` ‚Üí —É–¥–∞–ª–∏—Ç—Å—è —É –∫–ª–∏–µ–Ω—Ç–∞ + –≤ —Ç–æ–ø–∏–∫–µ (–æ–±–∞ —Å–æ–æ–±—â–µ–Ω–∏—è + –∫–æ–º–∞–Ω–¥–∞)

### –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ï—Å–ª–∏ —é–∑–µ—Ä **–µ—Å—Ç—å –≤ Calink**:
```
UID: 123
–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
@username
calink.ru/ivan
https://calink.ru/app?as_user=123
–¢–∞—Ä–∏—Ñ: pro
```

–ï—Å–ª–∏ **–Ω–µ—Ç –≤ Calink**:
```
‚ö†Ô∏è –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –ù–ï –ò–ó CALINK
@username
```
‚Üí –ü—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–æ–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –±–æ—Ç –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä—è–µ—Ç API –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É –µ—Å–ª–∏ —é–∑–µ—Ä –ø–æ—è–≤–∏–ª—Å—è.

---

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (SQLite)

### –¢–∞–±–ª–∏—Ü–∞ `users`
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `user_id` | INTEGER PK | Telegram user ID |
| `first_name` | TEXT | –ò–º—è –∏–∑ Telegram |
| `username` | TEXT | @username |
| `topic_id` | INTEGER | ID —Ç–æ–ø–∏–∫–∞ –≤ –≥—Ä—É–ø–ø–µ —Å–∞–ø–ø–æ—Ä—Ç–∞ |
| `is_calink_user` | INTEGER | 1 = –Ω–∞–π–¥–µ–Ω –≤ Calink |
| `card_message_id` | INTEGER | ID –∑–∞–ø–∏–Ω–µ–Ω–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ |
| `last_auto_reply` | TEXT | ISO timestamp –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∞–≤—Ç–æ-–æ—Ç–≤–µ—Ç–∞ |

### –¢–∞–±–ª–∏—Ü–∞ `messages`
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `group_message_id` | INTEGER | ID —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø–µ |
| `client_message_id` | INTEGER | ID —Å–æ–æ–±—â–µ–Ω–∏—è —É –∫–ª–∏–µ–Ω—Ç–∞ |
| `user_id` | INTEGER | Telegram user ID |
| `topic_id` | INTEGER | ID —Ç–æ–ø–∏–∫–∞ |

–ë–î —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ **Railway Volume** (`/data/support_bot.db`), –ª–æ–∫–∞–ª—å–Ω–æ ‚Äî —Ä—è–¥–æ–º —Å –±–æ—Ç–æ–º.

---

## –î–µ–ø–ª–æ–π

### –û–∫—Ä—É–∂–µ–Ω–∏—è

| –û–∫—Ä—É–∂–µ–Ω–∏–µ | –í–µ—Ç–∫–∞ Git | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|----------|
| **prod** | `main` | –ë–æ–µ–≤–æ–π –±–æ—Ç, —Ä–µ–∞–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ |
| **dev** | `dev` | –¢–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç, –æ—Ç–¥–µ–ª—å–Ω–∞—è –≥—Ä—É–ø–ø–∞ |

–£ –∫–∞–∂–¥–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å–≤–æ–π `BOT_TOKEN` –∏ `SUPPORT_GROUP_ID` –≤ Railway Variables.

### –§–ª–æ—É –¥–µ–ø–ª–æ—è

```
1. –ö–æ–¥ ‚Üí git push origin dev     ‚Üí Railway auto-deploy ‚Üí dev-–±–æ—Ç
2. –¢–µ—Å—Ç–∏—Ä—É–µ–º –Ω–∞ dev
3. git checkout main && git merge dev && git push origin main ‚Üí prod
```

**–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—É—à–∏–º –Ω–∞–ø—Ä—è–º—É—é –≤ `main`** ‚Äî —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ merge –∏–∑ `dev`.

### Railway

- –ö–∞–∂–¥—ã–π environment –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ GitHub –∏ –¥–µ–ø–ª–æ–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- Volume `/data/` —Ö—Ä–∞–Ω–∏—Ç SQLite –±–∞–∑—É (–ø–µ—Ä–µ–∂–∏–≤–∞–µ—Ç —Ä–µ–¥–µ–ø–ª–æ–∏)
- `Procfile`: `web: python3 bot.py`

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –≥—Ä—É–ø–ø–µ —Å–∞–ø–ø–æ—Ä—Ç–∞

1. –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å **supergroup** (–Ω–µ –ø—Ä–æ—Å—Ç–æ –≥—Ä—É–ø–ø–∞)
2. **Topics** –≤–∫–ª—é—á–µ–Ω—ã (Settings ‚Üí Topics)
3. –ë–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –∫–∞–∫ **–∞–¥–º–∏–Ω** —Å –ø—Ä–∞–≤–∞–º–∏: Manage Topics, Send Messages, Delete Messages, Pin Messages

---

## Calink API

```
POST https://calink.ru/api/hooks/support/user/info
Header: X-Support-Secret: <—Å–µ–∫—Ä–µ—Ç>
Body: {"telegram": 123456789}
```

–û—Ç–≤–µ—Ç 200: `{"uid": 123, "name": "...", "grub": "ivan", "tariff": "pro"}`
–û—Ç–≤–µ—Ç 404: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω

---

## –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å
git clone https://github.com/calinkru-hue/calink-helpbot.git
cd calink-helpbot

# 2. –°–æ–∑–¥–∞—Ç—å .env (–ø–æ —à–∞–±–ª–æ–Ω—É .env.example)
cp .env.example .env
# –ó–∞–ø–æ–ª–Ω–∏—Ç—å BOT_TOKEN –∏ SUPPORT_GROUP_ID

# 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å
python3 bot.py
```
